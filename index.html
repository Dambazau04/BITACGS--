<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BITCAGS CBT - Objective Exam</title>
  <style>
    /* ====== Brand colors (red, blue, white) ====== */
    :root{
      --brand-blue:#0d47a1;
      --brand-red:#d32f2f;
      --brand-white:#ffffff;
      --muted:#6b7280;
      --glass: rgba(255,255,255,0.06);
      --radius:16px;
      --shadow: 0 10px 30px rgba(13,71,161,0.12);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(135deg, #f8fafc 0%, #e8f0ff 100%);color:#0b1220}

    /* ===== Page Layout ===== */
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:32px}
    .card{width:100%;max-width:1100px;background:var(--brand-white);border-radius:20px;box-shadow:var(--shadow);overflow:hidden;display:grid;grid-template-columns:420px 1fr}

    /* ===== Left Panel: Branding + Login ===== */
    .panel-left{background:linear-gradient(180deg,var(--brand-blue),#183f7a);padding:34px;color:var(--brand-white);display:flex;flex-direction:column;gap:18px}
    .logo{display:flex;gap:12px;align-items:center}
    .logo .badge{width:64px;height:64px;border-radius:12px;background:var(--brand-red);display:flex;align-items:center;justify-content:center;font-weight:700;box-shadow:0 6px 18px rgba(0,0,0,0.12)}
    .title{font-size:20px;font-weight:700}
    .subtitle{opacity:0.9;color:rgba(255,255,255,0.9);font-size:13px}
    .login-box{margin-top:6px;background:rgba(255,255,255,0.06);padding:16px;border-radius:12px}
    .field{display:flex;flex-direction:column;margin-bottom:10px}
    .field label{font-size:13px;color:rgba(255,255,255,0.9);margin-bottom:6px}
    .field input{padding:10px;border-radius:8px;border:none;outline:none;background:rgba(255,255,255,0.06);color:var(--brand-white)}
    .btn{display:inline-block;padding:12px 16px;border-radius:10px;background:var(--brand-red);color:var(--brand-white);border:none;cursor:pointer;font-weight:700}
    .muted{font-size:12px;color:rgba(255,255,255,0.8)}

    /* ===== Right Panel: Exam area ===== */
    .panel-right{padding:28px}
    .exam-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    .school{font-size:18px;font-weight:800;color:var(--brand-blue)}
    .timer{font-weight:700;color:var(--brand-red);background:rgba(211,47,47,0.06);padding:8px 12px;border-radius:10px}

    /* ===== Question list ===== */
    .questions{display:flex;flex-direction:column;gap:18px}
    .qcard{border-radius:12px;padding:14px;border:1px solid #eef2ff;background:linear-gradient(180deg,#fff,#fbfdff)}
    .qmeta{display:flex;justify-content:space-between;margin-bottom:8px;color:var(--muted);font-size:13px}
    .qtext{font-weight:600;margin-bottom:8px}
    .choices{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .choice{padding:10px;border-radius:10px;border:1px solid #e6eefc;cursor:pointer}
    .choice input{margin-right:8px}

    /* ===== Footer controls ===== */
    .controls{display:flex;justify-content:space-between;align-items:center;margin-top:20px}
    .progress{flex:1;margin-right:16px;height:12px;background:#eef6ff;border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--brand-blue),var(--brand-red));width:0%}
    .submit-btn{background:var(--brand-blue);color:var(--brand-white);padding:12px 16px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
    .small{font-size:13px;color:var(--muted)}

    /* ===== Modal result ===== */
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(11,18,32,0.45);padding:20px;visibility:hidden;opacity:0;transition:all .2s}
    .modal.show{visibility:visible;opacity:1}
    .result-card{width:100%;max-width:760px;background:var(--brand-white);border-radius:14px;padding:20px}
    .result-top{display:flex;justify-content:space-between;align-items:center}
    .result-main{display:flex;gap:20px;margin-top:18px;flex-wrap:wrap}
    .result-block{flex:1;min-width:260px;padding:12px;border-radius:10px;border:1px solid #eef2ff}
    .result-actions{margin-top:18px;display:flex;gap:10px;justify-content:flex-end}

    /* ===== Printable A4 styling ===== */
    @media print{
      body *{visibility:hidden}
      #printable,*#printable *{visibility:visible}
      #printable{position:fixed;left:0;top:0;width:210mm;height:297mm;padding:36mm}
    }

    /* ===== Responsive ===== */
    @media (max-width:880px){
      .card{grid-template-columns:1fr}
      .panel-left{order:2}
      .panel-right{order:1}
    }

    /* Tiny helpers */
    .center{text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="application">

      <!-- LEFT: Branding & Login -->
      <div class="panel-left">
        <div class="logo">
          <div class="badge">B</div>
          <div>
            <div class="title">BITCAGS ICT TRAINING CENTER</div>
            <div class="subtitle">Computer-Based Test (Objective)</div>
          </div>
        </div>

        <div class="login-box" id="loginBox">
          <div class="muted">Login to start the 30-minute exam</div>
          <div style="height:10px"></div>
          <div class="field">
            <label>Username</label>
            <input id="username" placeholder="A2026" />
          </div>
          <div class="field">
            <label>Password</label>
            <input id="password" type="password" placeholder="BITCAGS2026" />
          </div>
          <div style="display:flex;gap:10px;align-items:center">
            <button class="btn" id="loginBtn">Login</button>
            <div class="muted">Use username: <strong>A2026</strong> password: <strong>BITCAGS2026</strong></div>
          </div>
        </div>

        <div style="margin-top:auto;font-size:13px;opacity:0.95">
          <div style="margin-bottom:6px">Exam instructions:</div>
          <ul style="padding-left:18px;margin:0;font-size:13px;color:rgba(255,255,255,0.92)">
            <li>Time limit: <strong>30 minutes</strong></li>
            <li>30 objective questions (multiple choice)</li>
            <li>Do not close the browser or you may lose progress</li>
          </ul>
        </div>
      </div>

      <!-- RIGHT: Exam area -->
      <div class="panel-right">
        <div class="exam-header">
          <div>
            <div class="school">BITCAGS ICT TRAINING CENTER — CBT PLATFORM</div>
            <div class="small">Student: <span id="studentNameDisplay">Guest</span> • Username: <span id="studentUsername">—</span></div>
          </div>

          <div class="timer" id="timer">30:00</div>
        </div>

        <div id="examArea" style="display:none">

          <div class="questions" id="questionsContainer"></div>

          <div class="controls">
            <div class="progress" title="Progress">
              <i id="progressBar" style="width:0%"></i>
            </div>
            <button class="submit-btn" id="submitBtn">Submit Exam</button>
          </div>
        </div>

        <div id="beforeStart" style="padding:24px;border:2px dashed #eef6ff;border-radius:12px">
          <div style="font-weight:700;margin-bottom:8px">Welcome</div>
          <div class="small">Please login using the provided username & password to begin the test. After login the timer will start automatically.</div>
        </div>

      </div>
    </div>
  </div>

  <!-- RESULT MODAL -->
  <div class="modal" id="resultModal">
    <div class="result-card">
      <div class="result-top">
        <div>
          <div style="font-weight:800;font-size:18px">Exam Completed</div>
          <div class="small">BITCAGS ICT TRAINING CENTER</div>
        </div>
        <div style="text-align:right">
          <div class="small">Inspector</div>
          <div style="font-weight:700">Aliyu Bashir Lawan</div>
        </div>
      </div>

      <div class="result-main" id="resultMain"></div>

      <div class="result-actions">
        <button class="btn" id="printBtn">Download / Print Result</button>
        <button class="btn" id="closeModal" style="background:#9ca3af">Close</button>
      </div>
    </div>
  </div>

  <!-- Hidden printable area for A4 result -->
  <div id="printable" style="display:none"></div>

  <script>
/* ===== NEW CBT SCRIPT: Randomized questions, one-attempt lock, WAEC/JAMB-style single-question view ===== */

// Original question bank (30 questions about the calculator lesson)
const ORIGINAL_QUESTIONS = [
  {q:"Which file name is used to save the calculator project?",choices:["index.js","calculator.html","style.css","calc.php"],answer:1},
  {q:"What does <!DOCTYPE html> tell the browser?",choices:["Use JavaScript","This is HTML5","Start CSS","Link images"],answer:1},
  {q:"Which tag wraps the entire HTML page?",choices:["<body>","<head>","<html>","<title>"],answer:2},
  {q:"Which section contains page information like title and CSS?",choices:["<body>","<script>","<head>","<div>"],answer:2},
  {q:"Which tag displays visible content on the page?",choices:["<meta>","<head>","<body>","<style>"],answer:2},
  {q:"What is the main container class for the calculator?",choices:[".display",".buttons",".calculator","#calculator"],answer:2},
  {q:"What is the ID used for the calculator screen?",choices:["screen","display","result","output"],answer:1},
  {q:"Which HTML element is clickable by users?",choices:["<div>","<span>","<button>","<p>"],answer:2},
  {q:"What does onclick do in a button?",choices:["Styles button","Runs JavaScript","Adds CSS","Refreshes page"],answer:1},
  {q:"Which CSS property centers items vertically and horizontally?",choices:["position","display:flex","float","margin"],answer:1},
  {q:"Which CSS property makes rounded edges?",choices:["border","padding","border-radius","margin"],answer:2},
  {q:"What does grid-template-columns: repeat(4,1fr) mean?",choices:["4 rows","4 equal columns","1 column","4 buttons"],answer:1},
  {q:"Which color property sets text color?",choices:["background","font","color","text-style"],answer:2},
  {q:"Which JavaScript method gets the display element?",choices:["query()","getElementById","getClass","select()"],answer:1},
  {q:"What variable stores the calculator screen?",choices:["screen","result","display","value"],answer:2},
  {q:"What happens when appendValue() runs?",choices:["Clears screen","Adds number","Calculates result","Refreshes page"],answer:1},
  {q:"Why check if display.innerText === '0'?",choices:["Avoid errors","Prevent 0123","Speed up code","Style text"],answer:1},
  {q:"Which function clears the calculator?",choices:["reset()","clearDisplay()","remove()","delete()"],answer:1},
  {q:"What does clearDisplay() set the screen to?",choices:["Empty","null","0","false"],answer:2},
  {q:"Which function calculates the result?",choices:["solve()","appendValue()","calculate()","math()"],answer:2},
  {q:"What does eval() do?",choices:["Adds style","Solves math","Creates HTML","Stops JS"],answer:1},
  {q:"What will eval('2+3*4') return?",choices:["20","14","24","9"],answer:1},
  {q:"Where is JavaScript placed in this project?",choices:["Inside CSS","Top of head","Bottom of body","Outside file"],answer:2},
  {q:"Which language handles calculator logic?",choices:["HTML","CSS","JavaScript","PHP"],answer:2},
  {q:"Which language designs the calculator look?",choices:["HTML","CSS","JavaScript","SQL"],answer:1},
  {q:"Which language creates structure?",choices:["CSS","JavaScript","HTML","Python"],answer:2},
  {q:"What happens after saving and opening the file?",choices:["Nothing","Calculator works","Error","Only CSS loads"],answer:1},
  {q:"Which event runs when a button is clicked?",choices:["onload","onclick","onhover","onsubmit"],answer:1},
  {q:"Which tag is used to add CSS inside HTML?",choices:["<css>","<style>","<script>","<link>"],answer:1},
  {q:"Which tag is used to write JavaScript?",choices:["<js>","<style>","<script>","<code>"],answer:2}
];

// Utility: shuffle an array (Fisher-Yates)
function shuffleArray(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

// Create a deep-shuffled copy: questions order + shuffled choices per question
function createShuffledQuestions(){
  const qCopy = shuffleArray(ORIGINAL_QUESTIONS).map(q=>{
    // create choices array with original index mapping
    const choiceObjs = q.choices.map((c,ci)=>({text:c,origIndex:ci}));
    const shuffledChoices = shuffleArray(choiceObjs);
    // find new index where origIndex === q.answer
    const newAnswerIndex = shuffledChoices.findIndex(ch => ch.origIndex === q.answer);
    return {q: q.q, choices: shuffledChoices.map(c=>c.text), answer: newAnswerIndex};
  });
  return qCopy;
}

// Single-attempt lock using localStorage
function hasAttempt(username){
  try{
    return !!localStorage.getItem(`bitcags_attempt_${username}`);
  }catch(e){return false}
}
function saveAttempt(username, result){
  try{
    localStorage.setItem(`bitcags_attempt_${username}`, JSON.stringify(result));
  }catch(e){/* ignore */}
}

// App state
let state = {
  started:false,
  minutes:30, seconds:0,
  interval:null,
  answers:{}, // key: question index in shuffledQuestions, value: choice index
  marked:{}, // mark for review
  currentIndex:0,
  shuffledQuestions:[],
  completed:false
};

// DOM refs
const loginBtn = document.getElementById('loginBtn');
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');
const examArea = document.getElementById('examArea');
const beforeStart = document.getElementById('beforeStart');
const studentNameDisplay = document.getElementById('studentNameDisplay');
const studentUsername = document.getElementById('studentUsername');
const questionsContainer = document.getElementById('questionsContainer');
const timerEl = document.getElementById('timer');
const submitBtn = document.getElementById('submitBtn');
const progressBar = document.getElementById('progressBar');

// New WAEC/JAMB style elements (created dynamically)
let paletteEl, qViewEl, navPrevBtn, navNextBtn, markBtn;

// Single allowed user from before
const ALLOWED_USER = {name: "Asma'u Ibrahim", username: 'A2026', password: 'BITCAGS2026'};

// Login handler with one-attempt lock check
loginBtn.addEventListener('click', ()=>{
  const u = (usernameInput.value||'').trim();
  const p = (passwordInput.value||'').trim();
  if(u === ALLOWED_USER.username && p === ALLOWED_USER.password){
    if(hasAttempt(u)){
      const saved = JSON.parse(localStorage.getItem(`bitcags_attempt_${u}`));
      alert('You have already attempted this exam. You cannot retake it.\nScore: ' + saved.correct + '/' + saved.total + ' ('+saved.percent+'%)');
      // show minimal info
      studentNameDisplay.innerText = ALLOWED_USER.name;
      studentUsername.innerText = ALLOWED_USER.username;
      document.getElementById('loginBox').style.display = 'none';
      beforeStart.style.display = 'none';
      // build small message in exam area
      examArea.style.display = 'block';
      questionsContainer.innerHTML = '<div style="padding:18px;border:1px solid #eef2ff;border-radius:12px">You have already completed the exam. Check the administrator for more details.</div>';
      return;
    }
    // start fresh
    studentNameDisplay.innerText = ALLOWED_USER.name;
    studentUsername.innerText = ALLOWED_USER.username;
    document.getElementById('loginBox').style.display = 'none';
    beforeStart.style.display = 'none';
    examArea.style.display = 'block';
    state.shuffledQuestions = createShuffledQuestions();
    setupWAECLayout();
    renderQuestionView();
    startTimer();
  } else {
    alert('Invalid username or password. Use B2026 / BITCAGS2026');
  }
});

// Setup WAEC/JAMB single-question layout: create palette and view controls
function setupWAECLayout(){
  questionsContainer.innerHTML = '';
  // main layout: left - question view, right - palette
  const wrapper = document.createElement('div');
  wrapper.style.display = 'flex';
  wrapper.style.gap = '16px';

  // question view (flex:1)
  qViewEl = document.createElement('div');
  qViewEl.style.flex = '1';
  qViewEl.id = 'qView';
  wrapper.appendChild(qViewEl);

  // right column with palette and controls
  const rightCol = document.createElement('div');
  rightCol.style.width = '220px';
  rightCol.style.display = 'flex';
  rightCol.style.flexDirection = 'column';
  rightCol.style.gap = '12px';

  // palette
  paletteEl = document.createElement('div');
  paletteEl.style.display = 'grid';
  paletteEl.style.gridTemplateColumns = 'repeat(5, 1fr)';
  paletteEl.style.gap = '8px';
  updatePalette();

  // nav controls
  const controls = document.createElement('div');
  controls.style.display = 'flex';
  controls.style.gap = '8px';

  navPrevBtn = document.createElement('button'); navPrevBtn.textContent = 'Previous'; navPrevBtn.className='submit-btn';
  navNextBtn = document.createElement('button'); navNextBtn.textContent = 'Next'; navNextBtn.className='submit-btn';
  markBtn = document.createElement('button'); markBtn.textContent = 'Mark for Review'; markBtn.className='btn'; markBtn.style.background='#6b7280';

  navPrevBtn.addEventListener('click', ()=>{ goToQuestion(state.currentIndex-1); });
  navNextBtn.addEventListener('click', ()=>{ goToQuestion(state.currentIndex+1); });
  markBtn.addEventListener('click', ()=>{ toggleMark(state.currentIndex); });

  controls.appendChild(navPrevBtn); controls.appendChild(navNextBtn);

  rightCol.appendChild(paletteEl);
  rightCol.appendChild(controls);
  rightCol.appendChild(markBtn);

  // progress and submit small
  const smallProgress = document.createElement('div');
  smallProgress.style.marginTop='8px';
  smallProgress.innerHTML = '<div class="small">Progress</div><div class="progress" style="margin-top:6px"><i id="progressBarSmall" style="width:0%"></i></div>';
  rightCol.appendChild(smallProgress);

  wrapper.appendChild(rightCol);
  questionsContainer.appendChild(wrapper);
  updateControls();
}

function updatePalette(){
  if(!paletteEl) return;
  paletteEl.innerHTML = '';
  const N = state.shuffledQuestions.length || 0;
  for(let i=0;i<N;i++){
    const btn = document.createElement('button');
    btn.textContent = i+1;
    btn.style.padding='8px';
    btn.style.borderRadius='8px';
    btn.style.cursor='pointer';
    btn.addEventListener('click', ()=>goToQuestion(i));
    // styling based on state
    if(state.answers[i] !== undefined) btn.style.background = 'linear-gradient(90deg,var(--brand-blue),var(--brand-red))', btn.style.color='#fff';
    else if(state.marked[i]) btn.style.background = '#fbbf24', btn.style.color='#111';
    else btn.style.background = '#eef6ff';
    paletteEl.appendChild(btn);
  }
}

// render a single question into qViewEl based on state.currentIndex
function renderQuestionView(){
  const idx = state.currentIndex;
  const qdata = state.shuffledQuestions[idx];
  if(!qdata) return;
  qViewEl.innerHTML = '';
  // question header
  const header = document.createElement('div');
  header.style.display='flex'; header.style.justifyContent='space-between'; header.style.alignItems='center';
  header.innerHTML = `<div style="font-weight:800">Question ${idx+1} of ${state.shuffledQuestions.length}</div><div class="small">Marks: 1</div>`;
  qViewEl.appendChild(header);

  const qtext = document.createElement('div'); qtext.style.margin='12px 0'; qtext.className='qtext'; qtext.textContent = qdata.q;
  qViewEl.appendChild(qtext);

  // choices
  const choicesWrap = document.createElement('div'); choicesWrap.className='choices'; choicesWrap.style.display='grid'; choicesWrap.style.gridTemplateColumns='1fr 1fr'; choicesWrap.style.gap='10px';
  qdata.choices.forEach((choice, ci)=>{
    const id = `q${idx}_c${ci}`;
    const label = document.createElement('label'); label.className='choice';
    label.style.display='flex'; label.style.alignItems='center'; label.style.gap='8px';
    const input = document.createElement('input'); input.type='radio'; input.name='q'+idx; input.value=ci; input.id=id;
    if(state.answers[idx] === ci) input.checked = true;
    input.addEventListener('change', ()=>{
      state.answers[idx] = Number(input.value);
      updateProgressAndPalette();
    });
    label.appendChild(input);
    const span = document.createElement('span'); span.innerText = String.fromCharCode(65+ci)+'. ' + choice;
    label.appendChild(span);
    choicesWrap.appendChild(label);
  });
  qViewEl.appendChild(choicesWrap);

  // footer with note and action buttons
  const footer = document.createElement('div'); footer.style.display='flex'; footer.style.justifyContent='space-between'; footer.style.alignItems='center'; footer.style.marginTop='12px';
  const left = document.createElement('div'); left.className='small'; left.textContent = state.marked[idx] ? 'Marked for review' : '';
  const right = document.createElement('div');
  const btnFinish = document.createElement('button'); btnFinish.textContent='Finish & Submit'; btnFinish.className='submit-btn';
  btnFinish.addEventListener('click', ()=>{ if(confirm('Submit exam now?')) gradeExam(); });
  right.appendChild(btnFinish);
  footer.appendChild(left); footer.appendChild(right);
  qViewEl.appendChild(footer);

  // update nav enable/disable
  updateControls();
}

function goToQuestion(i){
  if(i < 0) i = 0;
  if(i >= state.shuffledQuestions.length) i = state.shuffledQuestions.length -1;
  state.currentIndex = i;
  renderQuestionView();
}

function toggleMark(i){ state.marked[i] = !state.marked[i]; renderQuestionView(); updatePalette(); }

function updateProgressAndPalette(){
  const answered = Object.keys(state.answers).length;
  const pct = Math.round((answered / state.shuffledQuestions.length) * 100);
  const pb = document.getElementById('progressBar'); if(pb) pb.style.width = pct + '%';
  const pbs = document.getElementById('progressBarSmall'); if(pbs) pbs.style.width = pct + '%';
  updatePalette();
}

function updateControls(){
  navPrevBtn.disabled = state.currentIndex === 0;
  navNextBtn.disabled = state.currentIndex === state.shuffledQuestions.length -1;
}

// Timer (starts on login)
function startTimer(){
  if(state.started) return;
  state.started = true;
  let total = state.minutes*60 + state.seconds;
  timerEl.innerText = formatTime(total);
  state.interval = setInterval(()=>{
    total--;
    if(total < 0){ clearInterval(state.interval); autoSubmit(); return; }
    timerEl.innerText = formatTime(total);
  },1000);
}
function formatTime(sec){ const m = Math.floor(sec/60); const s = sec%60; return String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0'); }

// Auto-submit when time runs out
function autoSubmit(){ if(state.completed) return; alert('Time is up: your exam will be submitted'); gradeExam(); }

// Grade exam
function gradeExam(){
  if(state.completed) return;
  clearInterval(state.interval);
  let correct = 0;
  state.shuffledQuestions.forEach((q, idx)=>{
    const given = state.answers[idx];
    if(given !== undefined && Number(given) === q.answer) correct++;
  });
  const total = state.shuffledQuestions.length;
  const percent = Math.round((correct/total)*100);
  state.completed = true;
  // Save attempt to localStorage to lock one attempt
  const student = ALLOWED_USER;
  const result = {correct,total,percent, date: new Date().toISOString()};
  saveAttempt(student.username, result);
  showResult({correct,total,percent});
}

// Inspector comment depending on performance
function inspectorComment(percent){
  if(percent >= 80) return 'Excellent performance. Keep up the outstanding work.';
  if(percent >= 60) return 'Good performance. A little more effort will make it excellent.';
  if(percent >= 40) return 'Average performance. You need to practice more to improve.';
  return 'Poor performance. Please review the materials and try again.';
}

// Show result modal and prepare printable A4 result (unchanged styling but updated to include note about one attempt)
function showResult({correct,total,percent}){
  const resultMain = document.getElementById('resultMain');
  const comment = inspectorComment(percent);
  const student = ALLOWED_USER;
  const verificationText = `BITCAGS|${student.username}|${correct}/${total}|${percent}%|${new Date().toISOString()}`;
  const qrSrc = `https://chart.googleapis.com/chart?chs=180x180&cht=qr&chl=${encodeURIComponent(verificationText)}`;

  resultMain.innerHTML = `
    <div class="result-block">
      <div style="font-size:20px;font-weight:800">Score: ${correct} / ${total}</div>
      <div class="small">Percentage: ${percent}%</div>
      <div style="margin-top:8px;font-weight:700;color:var(--brand-blue)">${comment}</div>
    </div>

    <div class="result-block">
      <div style="font-weight:700">Student Information</div>
      <div style="margin-top:6px">Name: ${student.name}</div>
      <div>Username: ${student.username}</div>
      <div style="margin-top:8px">Inspector: Aliyu Bashir Lawan</div>
      <div style="margin-top:6px;font-size:12px;color:#6b7280">Note: This exam is locked to one attempt. Previous attempts cannot retake.</div>
    </div>

    <div style="min-width:160px;display:flex;flex-direction:column;align-items:center;gap:10px">
      <img src="${qrSrc}" alt="QR" style="width:140px;height:140px;border-radius:10px;border:1px solid #eef2ff" />
      <div class="small center">Scan to verify</div>
    </div>
  `;

  // Printable A4 content
  const printable = document.getElementById('printable');
  printable.style.display='block';
  printable.innerHTML = `
    <div style="width:210mm;min-height:297mm;padding:20mm;font-family:Inter, Arial;box-sizing:border-box;color:#0b1220;background:#fff">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
        <div>
          <div style="font-size:20px;font-weight:800;color:${'var(--brand-blue)'}">BITCAGS ICT TRAINING CENTER</div>
          <div style="margin-top:6px;font-size:13px;color:#374151">CBT Objective Exam Result</div>
        </div>
        <div style="text-align:right">
          <div style="font-weight:700">Inspector</div>
          <div>Aliyu Bashir Lawan</div>
        </div>
      </div>

      <hr style="border:none;border-top:2px solid #eef2ff;margin:10px 0 18px 0" />

      <div style="display:flex;gap:18px;margin-bottom:18px">
        <div style="flex:1">
          <div style="font-weight:700;margin-bottom:6px">Student</div>
          <div>Name: ${student.name}</div>
          <div>Username: ${student.username}</div>
        </div>
        <div style="width:160px;text-align:center">
          <img src="${qrSrc}" style="width:140px;height:140px;border:1px solid #eef2ff" />
          <div style="font-size:12px;margin-top:6px">Verification QR</div>
        </div>
      </div>

      <div style="border:1px solid #eef2ff;padding:14px;border-radius:10px;margin-bottom:18px">
        <div style="font-weight:800;font-size:28px;color:${'var(--brand-blue)'}">${correct} / ${total}</div>
        <div style="margin-top:6px">Percentage: <strong>${percent}%</strong></div>
        <div style="margin-top:8px">Inspector comment: <em>${comment}</em></div>
        <div style="margin-top:8px;font-size:12px;color:#6b7280">Attempt locked: This exam permits only one attempt per candidate.</div>
      </div>

      <div style="font-size:12px;color:#6b7280">This document is generated by BITCAGS CBT System. Scan the QR code to verify result data.</div>
    </div>
  `;

  document.getElementById('resultModal').classList.add('show');
}

// Print / Download button
document.getElementById('printBtn').addEventListener('click', ()=>{
  const printable = document.getElementById('printable').innerHTML;
  const w = window.open('', '_blank', 'width=900,height=1200');
  w.document.write(`<!doctype html><html><head><title>Result - BITCAGS</title><meta name="viewport" content="width=device-width,initial-scale=1"/></head><body>${printable}</body></html>`);
  w.document.close();
  setTimeout(()=>{ w.print(); },800);
});

document.getElementById('closeModal').addEventListener('click', ()=>{ document.getElementById('resultModal').classList.remove('show'); });

// Warn user before leaving if exam in progress
window.addEventListener('beforeunload', function(e){ if(state.started && !state.completed){ e.preventDefault(); e.returnValue = ''; } });

</script>
</body>
</html>
